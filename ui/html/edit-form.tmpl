{{define "edit-form"}}
<div id="edit-form" class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-bold mb-4">Edit Gratitude Note</h2>
    
    <form hx-put="/gratitude/update/{{.ID}}"
          hx-target="#note-{{.ID}}"
          hx-swap="outerHTML"
          hx-on::before-request="console.log('Starting update request for note:', {{.ID}})"
          hx-on::after-request="console.log('Update request completed'); document.getElementById('edit-form-container').classList.add('hidden')"
          hx-on::error="console.error('Error updating note:', event.detail)"
          hx-headers='{"Content-Type": "application/x-www-form-urlencoded"}'
          class="space-y-4">
        
        <input type="hidden" name="id" value="{{.ID}}">
        
        <div>
            <label for="edit-title" class="block text-sm font-medium text-gray-700">Title</label>
            <input type="text" id="edit-title" name="title" value="{{.Title}}" required
                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
        </div>
        
        <div>
            <label for="edit-content" class="block text-sm font-medium text-gray-700">Content</label>
            <textarea id="edit-content" name="content" rows="4" required
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">{{.Content}}</textarea>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">How are you feeling?</label>
            <div class="flex space-x-4">
                <button type="button" 
                        class="emoji-btn text-3xl p-2 rounded-full hover:bg-gray-100 transition-colors duration-200 {{if eq .Emoji "ðŸ˜Š"}}bg-gray-200{{end}}"
                        data-emoji="ðŸ˜Š"
                        onclick="selectEmoji(this, 'edit-selected-emoji')">
                    ðŸ˜Š
                </button>
                <button type="button"
                        class="emoji-btn text-3xl p-2 rounded-full hover:bg-gray-100 transition-colors duration-200 {{if eq .Emoji "ðŸ˜¢"}}bg-gray-200{{end}}"
                        data-emoji="ðŸ˜¢"
                        onclick="selectEmoji(this, 'edit-selected-emoji')">
                    ðŸ˜¢
                </button>
                <button type="button"
                        class="emoji-btn text-3xl p-2 rounded-full hover:bg-gray-100 transition-colors duration-200 {{if eq .Emoji "ðŸ˜¡"}}bg-gray-200{{end}}"
                        data-emoji="ðŸ˜¡"
                        onclick="selectEmoji(this, 'edit-selected-emoji')">
                    ðŸ˜¡
                </button>
                <button type="button"
                        class="emoji-btn text-3xl p-2 rounded-full hover:bg-gray-100 transition-colors duration-200 {{if eq .Emoji "ðŸ¤©"}}bg-gray-200{{end}}"
                        data-emoji="ðŸ¤©"
                        onclick="selectEmoji(this, 'edit-selected-emoji')">
                    ðŸ¤©
                </button>
            </div>
            <input type="hidden" name="emoji" id="edit-selected-emoji" value="{{.Emoji}}" required>
        </div>
        
        <div>
            <label for="edit-category" class="block text-sm font-medium text-gray-700">Category</label>
            <select id="edit-category" name="category"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                <option value="personal" {{if eq .Category "personal"}}selected{{end}}>Personal</option>
                <option value="work" {{if eq .Category "work"}}selected{{end}}>Work</option>
                <option value="family" {{if eq .Category "family"}}selected{{end}}>Family</option>
                <option value="achievements" {{if eq .Category "achievements"}}selected{{end}}>Achievements</option>
            </select>
        </div>
        
        <div class="flex space-x-4">
            <button type="submit" 
                    class="flex-1 bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                Save Changes
            </button>
            <button type="button" 
                    onclick="document.getElementById('edit-form-container').classList.add('hidden')"
                    class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                Cancel
            </button>
        </div>
    </form>
</div>

<script>
function selectEmoji(button, inputId) {
    // Remove highlight from all emoji buttons in the same container
    button.parentElement.querySelectorAll('.emoji-btn').forEach(btn => {
        btn.classList.remove('bg-gray-200');
    });
    
    // Add highlight to selected emoji button
    button.classList.add('bg-gray-200');
    
    // Update hidden input with selected emoji
    document.getElementById(inputId).value = button.getAttribute('data-emoji');
}
</script>
{{end}} 